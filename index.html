<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Revelstoke Mountain Resort Dashboard</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

        body {
            margin: 0;
            padding: 20px;
            background-color: #000;
            color: #3a9188;
            font-family: 'Press Start 2P', cursive;
            background-image: linear-gradient(rgba(8, 8, 8, 0.9), rgba(8, 8, 8, 0.9)),
                repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(58, 145, 136, 0.05) 2px, rgba(58, 145, 136, 0.05) 4px);
        }
        .dashboard {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            grid-template-rows: auto 1fr 1fr;
            gap: 20px;
            height: 95vh;
        }
        .webcam-container {            
            position: relative;
            background-color: #000;
            border-radius: 0;
            overflow: hidden;
            height: 100%;
            border: 4px solid #3a9188;
            box-shadow: 0 0 10px #3a9188, inset 0 0 10px #3a9188;
        }
        .webcam-title {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: #000;
            padding: 5px 10px;
            border: 2px solid #3a9188;
            text-shadow: 0 0 5px #3a9188;
            z-index: 1;
        }
        .webcam-feed {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: brightness(1.2) contrast(1.2) saturate(1.2);
            animation: scanline 2s linear infinite;
        }
        .snow-report {
            grid-column: 1 / -1;
            background-color: #000;
            padding: 20px;
            border: 4px solid #3a9188;
            box-shadow: 0 0 10px #3a9188, inset 0 0 10px #3a9188;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .last-updated {
            font-size: 0.9em;
            color: #8BA3C7;
        }
        .snow-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            text-align: center;
        }
        .snow-stat {
            background-color: #000;
            padding: 15px;
            border: 2px solid #3a9188;
            transition: all 0.2s ease;
            animation: pulse 2s infinite;
        }
        .snow-stat:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 20px #3a9188;
        }
        .snow-stat h3 {
            margin: 0 0 10px 0;
            font-size: 0.7em;
            color: #3a9188;
        }
        .snow-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #fff;
            text-shadow: 0 0 5px #3a9188;
        }
        .unit {
            font-size: 0.5em;
            margin-left: 5px;
            color: #3a9188;
        }
        .temp-stat {
            background-color: #000;
            padding: 15px;
            border: 2px solid #3a9188;
            transition: all 0.2s ease;
            animation: pulse 2s infinite;
        }
        .temp-stat:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 20px #3a9188;
        }
        .temp-stat h3 {
            margin: 0 0 10px 0;
            font-size: 0.7em;
            color: #3a9188;
        }
        .forecast-ticker {
            padding: 10px 0;
            margin-top: 20px;
            border-top: 2px solid #3a9188;
        }

        .forecast-ticker-content {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 10px;
        }

        .forecast-item {
            color: #3a9188;
            text-shadow: 0 0 5px #3a9188;
            font-size: 0.8em;
        }

        .forecast-item strong {
            color: white;
            margin-left: 8px;
        }

        .forecast-item emoji {
            margin-left: 5px;
            font-size: 1.2em;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 5px #3a9188; }
            50% { box-shadow: 0 0 15px #3a9188; }
            100% { box-shadow: 0 0 5px #3a9188; }
        }

        @keyframes scanline {
            0% {
                background: linear-gradient(to bottom,
                    rgba(58, 145, 136, 0) 50%,
                    rgba(58, 145, 136, 0.08) 50%
                );
                background-size: 100% 4px;
            }
            100% {
                background: linear-gradient(to bottom,
                    rgba(58, 145, 136, 0) 50%,
                    rgba(58, 145, 136, 0.08) 50%
                );
                background-size: 100% 4px;
            }
        }
    </style>
</head>
<body>
    
    <div class="dashboard">
        <div class="snow-report" id="snow-report">            
            <div id="snow-data">Loading snow report...</div>
        </div>
        <div class="webcam-container">
            <div class="webcam-title">Snow Gnome</div>
            <img class="webcam-feed" src="https://www.revelstokemountainresort.com/uploads/gnorm/gnorm.jpg" alt="Snow Gnome Webcam">
        </div>
        <div class="webcam-container">
            <div class="webcam-title">Stoke (2,225ft)</div>
            <img class="webcam-feed" id="mid-cam" alt="Stoke" src="https://relay.ozolio.com/pub.api?cmd=poster&oid=EMB_KPMC000010BF">
        </div>
        <div class="webcam-container">
            <div class="webcam-title">Ripper (1,960ft)</div>
            <img class="webcam-feed" id="summit-cam" alt="Summit Webcam" src="https://www.revelstokemountainresort.com/uploads/ripper/ripper-medium.jpg?1731007472">
        </div>
        <div class="webcam-container">
            <div class="webcam-title">Village</div>
            <img class="webcam-feed" id="park-cam" alt="Terrain Park Webcam" src="https://relay.ozolio.com/pub.api?cmd=poster&oid=EMB_PVWK000010B0">
        </div>
        
    </div>

    <script>
        // Configuration - Replace these with actual webcam URLs
        const webcams = {
            'base-cam': 'URL_TO_BASE_WEBCAM',
            'mid-cam': 'URL_TO_MID_WEBCAM',
            'summit-cam': 'URL_TO_SUMMIT_WEBCAM',
            'park-cam': 'URL_TO_PARK_WEBCAM'
        };

        // Update webcam feeds
        function updateWebcams() {
            for (const [id, url] of Object.entries(webcams)) {
                const img = document.getElementById(id);
                // Add timestamp to prevent caching
                //img.src = `${url}?t=${Date.now()}`;
            }
        }

        // Fetch snow report
        async function fetchSnowReport() {
            try {
                const url = 'https://www.revelstokemountainresort.com/mountain/conditions/snow-report/';
                const proxyUrl = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(url);
                
                const response = await fetch(proxyUrl);
                const html = await response.text();
                
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');

                const url2 = 'https://www.revelstokemountainresort.com/snow-weather-json/';
                const proxyUrl2 = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(url2);
                const response2 = await fetch(proxyUrl2);
                const data2 = await response2.json();
                console.log(data2);
                
                // Extract existing snow data
                const newSnow = doc.querySelector('.snow-report__new .snow-report__data .value')?.textContent.trim() || '0';
                const lastHour = doc.querySelector('#main > section.snow-report__section > div > div > div.snow-report__details > div.snow-report__amounts > div:nth-child(1) > span > span.value')?.textContent.trim() || '0';
                const last24Hours = doc.querySelector('#main > section.snow-report__section > div > div > div.snow-report__details > div.snow-report__amounts > div:nth-child(2) > span > span.value')?.textContent.trim() || '0';
                const last48Hours = doc.querySelector('#main > section.snow-report__section > div > div > div.snow-report__details > div.snow-report__amounts > div.snow-report__amount.amount3 > span > span.value')?.textContent.trim() || '0';
                const last7Days = doc.querySelector('#main > section.snow-report__section > div > div > div.snow-report__details > div.snow-report__amounts > div.snow-report__amount.amount4 > span > span.value')?.textContent.trim().replace('cm', '') || '0';

                // Extract temperature data
                const baseTemp = data2.weather.temperature;
                const ripperTemp = data2.summit.temperature;
                const subpeakTemp = data2.subpeak.temperature;

                // Extract forecast data (you'll need to adjust these selectors based on the actual HTML structure)
                const forecast = [];
                const forecastElements = doc.querySelectorAll('#alpine > div > section > div')[0].children;
                console.log(forecastElements);
                for (let i = 0; i < forecastElements.length; i++) {
                    const day = forecastElements[i];
                    const snow = day.querySelector('div.weather-forecast__description > ul > li:nth-child(1)')?.textContent.trim() || '0';
                    const date = day.querySelector('h3')?.textContent.trim() || '';                                       
                    forecast.push({
                        date: date,
                        snow: snow.includes('Snow') ? snow.split('  ')[1] : '0'
                    });
                }
                console.log(forecast);
                
                const data = {
                    newSnow,
                    lastHour,
                    last24Hours,
                    last48Hours,
                    last7Days,
                    temperatures: {
                        base: baseTemp,
                        ripper: ripperTemp,
                        subpeak: subpeakTemp
                    },
                    forecast
                };
                
                updateSnowReport(data);
            } catch (error) {
                console.error('Error fetching snow report:', error);
                document.getElementById('snow-data').innerHTML = 'Error loading snow report. Please refresh the page.';
            }
        }

        // Update snow report display
        function updateSnowReport(data) {
            const snowData = document.getElementById('snow-data');
            
            // Create forecast ticker HTML
            const forecastTickerHTML = data.forecast.map(day => `
                <span class="forecast-item">
                    ${day.date}:<strong>${day.snow}</strong>
                    ${day.snow !== '0' ? '😊' : '❌'}
                </span>
            `).join('');

            snowData.innerHTML = `
                <div class="snow-stats">
                    <div class="snow-stat">
                        <h3>New Snow</h3>
                        <div class="snow-value">${data.newSnow}<span class="unit">cm</span></div>
                    </div>
                    <div class="snow-stat">
                        <h3>Last Hour</h3>
                        <div class="snow-value">${data.lastHour}<span class="unit">cm</span></div>
                    </div>
                    <div class="snow-stat">
                        <h3>Last 24h</h3>
                        <div class="snow-value">${data.last24Hours}<span class="unit">cm</span></div>
                    </div>
                    <div class="snow-stat">
                        <h3>Last 48h</h3>
                        <div class="snow-value">${data.last48Hours}<span class="unit">cm</span></div>
                    </div>
                    <div class="snow-stat">
                        <h3>Last 7d</h3>
                        <div class="snow-value">${data.last7Days}<span class="unit">cm</span></div>
                    </div>
                    <div class="temp-stat">
                        <h3>Base Temp</h3>
                        <div class="snow-value">${data.temperatures.base}<span class="unit">°C</span></div>
                    </div>
                    <div class="temp-stat">
                        <h3>Ripper Temp</h3>
                        <div class="snow-value">${data.temperatures.ripper}<span class="unit">°C</span></div>
                    </div>
                    <div class="temp-stat">
                        <h3>Subpeak Temp</h3>
                        <div class="snow-value">${data.temperatures.subpeak}<span class="unit">°C</span></div>
                    </div>
                </div>
                <div class="forecast-ticker">
                    <div class="forecast-ticker-content">
                        ${forecastTickerHTML}
                    </div>
                </div>
            `;
        }

        function updateTimestamp() {
            const now = new Date();            
        }
    
        // Initialize and set update intervals
        function init() {
            updateWebcams();
            fetchSnowReport();       

            // Refresh webcams every 5 minutes
            setInterval(updateWebcams, 5 * 60 * 1000);
            
            // Refresh snow report every 30 minutes
            setInterval(fetchSnowReport, 30 * 60 * 1000);
            
            // Update timestamp every minute
            setInterval(updateTimestamp, 60 * 1000);
        }

        // Start the application
        init();
    </script>
</body>
</html>